name: Deploy to GitHub Pages

on:
  push:
    branches: [main]  # DÃ©clenche le workflow Ã  chaque push sur la branche main

permissions:
  contents: write     # NÃ©cessaire pour publier sur gh-pages

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ” Cloner le dÃ©pÃ´t
        uses: actions/checkout@v4  # Utilise la derniÃ¨re version de checkout

      - name: ğŸ§° Configurer Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20  # Compatible avec React 19
          cache: 'npm'      # Mise en cache des dÃ©pendances pour accÃ©lÃ©rer

      - name: ğŸ“¦ Installer les dÃ©pendances
        run: npm ci  # Utilise npm ci pour une installation reproductible

      - name: ğŸ—ï¸ Construire lâ€™application
        run: npm run build --verbose
        env:
          CI: true  # Active le mode CI pour des erreurs plus explicites

      - name: ğŸš€ DÃ©ployer sur GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist  # Ajustez Ã  ./build si vous utilisez Create React App

      - name: ğŸ“ Post Configurer Node.js
        if: always()  # ExÃ©cute cette Ã©tape mÃªme en cas d'Ã©chec
        run: echo "DÃ©ploiement terminÃ©"

      - name: ğŸ”„ Post Cloner le dÃ©pÃ´t
        if: always()
        run: echo "Nettoyage terminÃ©"